<div sfr-card class="p-6 table-dropdown" *ngIf="_dados" [formGroup]="_form">
    <div class="d-flex flex-align-center mb-6">
        <div class="s1 fg-support03-medium">Extrato - {{ _dados.data | date: 'dd/MM/YYYY' }} ({{ _dados.data | date: 'EEEE' | titlecase }})</div>
        <div class="title-divider"></div>
    </div>
    <div class="mb-10">
        <sfr-table-filter [config]="_filtrosExibidos" [dadosTabela]="_extrato"></sfr-table-filter>
    </div>

    <div class="w-100 pos-relative" *ngIf="_form">
        <sfr-spinner [name]="estado.spinnerId" [text]="estado.spinnerMensagem"></sfr-spinner>
        <mat-table matSort multiTemplateDataRows="true" [dataSource]="_extrato" class="w-100" formArrayName="extrato">
            <ng-container matColumnDef="lancamento">
                <mat-header-cell mat-sort-header *matHeaderCellDef sortActionDescription="Ordenar por lançamento">Lançamento</mat-header-cell>
                <mat-cell class="p3" *matCellDef="let element">
                    <div *ngIf="element.estorno" class="p3 fg-neutral-medium" style="text-decoration: line-through">{{ element.descricao }}</div>
                    <div *ngIf="!element.estorno" class="p3">{{ element.descricao }}</div>
                </mat-cell>
            </ng-container>

            <ng-container matColumnDef="valor">
                <mat-header-cell mat-sort-header *matHeaderCellDef sortActionDescription="Ordenar por valor">Valor</mat-header-cell>
                <mat-cell class="p3" *matCellDef="let element">
                    <div *ngIf="element.estorno" class="p3 fg-neutral-medium" style="text-decoration: line-through">{{ element.valor | currency }}</div>
                    <div *ngIf="!element.estorno" class="p3">{{ element.valor | currency }}</div>
                </mat-cell>
            </ng-container>

            <ng-container matColumnDef="expand">
                <mat-header-cell mat-sort-header *matHeaderCellDef>&nbsp;</mat-header-cell>
                <mat-cell class="p3" *matCellDef="let element">
                    <button sfr-button-flat--transparent class="fg-inherit bg-inherit-hover" (clicarEvento)="expandirLinha(element)">
                        <div class="s3 fg-support01-darkest mr-2">Mais opções</div>
                        <sfr-icon *ngIf="!element.expandido" icon="chevron-down" [iconClass]="['fg-support01-darkest', 's3']"></sfr-icon>
                        <sfr-icon *ngIf="element.expandido" icon="chevron-up" [iconClass]="['fg-support01-darkest', 's3']"></sfr-icon>
                    </button>
                </mat-cell>
            </ng-container>

            <ng-container matColumnDef="expandedDetail">
                <td class="w-100" mat-cell *matCellDef="let element; let i = dataIndex">
                    <div class="d-flex gap-4 flex-align-center flex-justify-between mb-4 mt-4 w-100" [formGroupName]="i">
                        <div class="w-100">
                            <sfr-select placeholder="Conta Débito" [label]="true" [control]="obterControlePorIndice(i)" controlName="planoContaDebitoId" [options]="_listaPlanoContas"></sfr-select>
                        </div>
                        <div class="w-100">
                            <sfr-select placeholder="Conta Crédito" [label]="true" [control]="obterControlePorIndice(i)" controlName="planoContaCreditoId" [options]="_listaPlanoContas"></sfr-select>
                        </div>

                        <div class="w-100">
                            <sfr-input type="texto" placeholder="Complemento" [control]="obterControlePorIndice(i)" controlName="complemento"></sfr-input>
                        </div>
                        <div class="d-flex flex-align-center">
                            <sfr-checkbox [control]="obterControlePorIndice(i)" controlName="contabilizar">Contabilizar</sfr-checkbox>
                        </div>
                        <div>
                            <button sfr-button-outline--primary size="fit" [disabled]="obterControlePorIndice(i).invalid" (clicarEvento)="salvar(i)">Salvar</button>
                        </div>
                    </div>
                </td>
            </ng-container>

            <mat-header-row *matHeaderRowDef="_colunasExibidas"></mat-header-row>
            <mat-row *matRowDef="let row; columns: _colunasExibidas" matRipple class="element-row" [class.expanded]="row.expandido"></mat-row>
            <mat-row *matRowDef="let row; columns: ['expandedDetail']" [@detailExpand]="row.expandido ? 'expanded' : 'collapsed'" style="overflow: hidden"> </mat-row>

            <div *matNoDataRow class="p1 fg-neutral-medium p-4">Sem dados para exibir no momento.</div>
        </mat-table>
    </div>
</div>
